<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    {% block title %}<title>NAFAN - The National Finding Aid Network</title>{% endblock %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">

    <!-- Add additional CSS in static file -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'site.css' %}"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js">  </script>    
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">  </script> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>    
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"rel="stylesheet" type="text/css" />  

</head>

<body>

<div class="container_fluid">

  <div class="row top-buffer">

      <div class="col-sm-2">
        {% if user_type == "contributor_admin" %}
           <a href="/contributor_admin">Admin</a>
        {% else %}
           <a href="/nafan_admin">Admin</a>
        {% endif %}
      </div>

      <div class="col-sm-8">
         <h2 class="page-header text-center">Users</h2>
     </div>

      <div class="col-sm-2">
          <button class="btn btn-md btn-primary float-right" type="button" onclick="location.href='/logout'">Logout</button>
      </div>
      
  </div>

	<div class="row justify-content-center grid-buffer">

    <div class="col-12 col-md-10 col-lg-8">

        {% if user_type == "contributor_admin" %}
          <p>A Contributor Admin is responsible for maintaining users within their associated repositories.  A Contributor Admin
             can make other users Contributor Admins and limit the repositories they can manage.  If a user only has a single
             repository, the Repositories link in the table show not show.  All associated users are automatically assigned 
             that repository.
          </p>
        {% else %}
          <p>A NAFAN Admin is primarily responsible for maintaining other NAFAN admin users along with contributer admin users.  In the
             interest of responsiveness, I suggest either a minimum number of users are displayed by default or no users at all are
             displayed initially.  The thinking is that an admin comes here knowing what they want to do which is either edit a specific
             user or create a user.   Browsing is an unlikely operation.  The Edit link in the table should be obvious.  The Repositories
             link takes the user to a page where repositories can be associated with a particular user.  For larger parent organizations
             we may want to consider a bulk assignment of all users to a set of repositories.  The usefulness of this needs investigation.
          </p>
        {% endif %}

    </div>

    <div class="row justify-content-center">

      <div class="col-md-6">

        <form method="get">
        {% csrf_token %}

        <div class="form_field_container" id="search_area">
          <select class="form-control medium_field manage_search" id="search_field" name="search_field">
            <option value="email" {% if searchField == "email" %}selected="selected"{% endif %} >Username</option>
            <option value="full_name" {% if searchField == "full_name" %}selected="selected"{% endif %}>Full Name</option>
          </select>
          <input class="form-control manage_search medium_field" type="search" name="searchTerm" placeholder="Search users" >
          <button type="submit" class="btn btn-primary manage_search" id="search"><span class="fa fa-search" aria-hidden="true"></span> Search</button>
        </div>

      </div>

      <div class="col-md-6">

        <div class="form_field_container float-lg-right" id="new_button_area">
          <select class="form-control medium_field manage_search" onchange="this.form.submit()" id="status_filter" name="status_filter">
            <option value="">All Users</option>
            <option value="Active" {% if status == "Active" %}selected="selected"{% endif %} >Active Users</option>
            <option value="Inactive" {% if status == "Inactive" %}selected="selected"{% endif %}>Inactive Users</option>
          </select>
          <div class="button_container">
            <button type="button" class="btn btn-primary manage_search" id="new" onclick="location.href='/Admin/user_new'"><span class="fal fa-ticket-alt icon_spacer"></span> New User</button>
          </div>
        </div>

      </div>
        </form>

      <div class="col-sm-12">

        <br/>
        <div class="table-responsive">
          <table class="table table-striped">

            <tr>
              <th>Username</th>
              <th>Full name</th>
              <th>User type</th>
              <th>Status</th>
              <th></th>
              <th></th>
            </tr>

            {% for item in users %}
              <tr> 
                <td>{{ item.email }}</td>
                <td>{{ item.full_name }}</td>
                <td>{{ item.user_type }}</td>
                <td>{{ item.status }}</td>
                <td><a  id="edit" href='/Admin/user_edit/{{ item.id }}'" > Edit</a> </td>
                <td><a  id="repository" href='/Admin/user_repositories?username={{ item.email }}'" > Repositories</a> </td>

                {% comment %} <td><a  id="delete" href='/Admin/user_delete/{{ item.id }}'" > Delete</a> </td> {% endcomment %}
              </tr>
            {% endfor %}

          </table>
        </div>

      </div>

    </div>

  </div>

  <div class="row top-buffer">
    <p><b>Need to determine how a contributor_admin only sees associated users</b></p>
  </div>

</div>
