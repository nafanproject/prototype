<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    {% block title %}<title>NAFAN - The National Finding Aid Network</title>{% endblock %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">

    <!-- Add additional CSS in static file -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'site.css' %}"/>

     <style>


.page-header {
    color: #5cb85c;
  }

.message {
  color: cadetblue;
}

.top-buffer { 
  margin-top:20px; 
  margin-bottom:10px;
  margin-left: 10px;
  margin-right: 10px;
}

.grid-buffer { 
  margin-bottom:10px;
  margin-left: 10px;
  margin-right: 10px;
}

#id_username,
#id_password {
  width: 300px;
}

ul {
  list-style-type: none;
}

select {
  border:1px solid #ccc;
  vertical-align:top;
  height:30px;
}

.manage_page_container {
  margin: 0 0 20px 0;
  padding: 0;
  display: block;
  overflow: hidden;
}

.background_content {
  background-color: #ffff;
  /* border: 1px solid #ced4da; */
}

h3.section_title {
  font-family: "Open Sans", Helvetica, Arial, san-serif;
  font-size: 30px;
  color:#5cb85c;
  display: inline-block;
  margin: 10px 0 15px 0;
  padding: 0;
}

svg.icon_spacer {
  display: inline-block;
  margin-right: 5px;
}

.form_field_container {
  margin: 0 0 10px 0;
  display:block;
  overflow:hidden;
}

label.form_label {
  width: auto;
  font-weight: 600;
  margin: 5px 10px 0 0;
  display: block;
  overflow: hidden;
}

input.medium_field,
select.medium_field {
  width: 200px !important;
}

input.large_field,
select.large_field {
  width: 300px !important;
}

input.ex_large_field,
select.ex_large_field {
  width: 500px !important;
}

input.manage_search {
  float: left;
  width: 300px;
  margin: 0 10px, 0 0;
}

select.manage_search {
  float: left;
  margin: 0 20px, 0 0;
}

button.manage_search {
  float: left;
  background-color: #2371c3;
  border-color: #2371c3;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  margin: 0;
  margin-left: 5px;
  cursor: pointer;
}

input.search_field {
  height: 30px;
  border-right: none;
}

.button_container {
  display: inline-block;
  overflow: hidden;
  margin: 0 0 0, 20px;
  padding: 0;
}

button.manage_button {
  float: left;
  margin-right: 10px;
  display: block;
  overflow: hidden;
}

.field_caption {
  color: cadetblue;
}

.table_header {
  cursor: pointer;
}
    </style>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js">  </script>    
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">  </script> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>    
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"rel="stylesheet" type="text/css" />  

</head>

<body>

<div class="container_fluid">

    <div class="row top-buffer">

        <div class="col-sm-4">
        </div>

        <div class="col-sm-4">
            <h2 class="page-header text-center"> Organizations </h2>
        </div>

        <div class="col-sm-2">
            <a class="float-right" href="/contact">Contact Us</a>
        </div>
      
        <div class="col-sm-2">
            <a class="float-right" href="/">Main</a>
        </div>
      
    </div>

      <form method="get">
      {% csrf_token %}

        <div class="row grid-buffer">

          <div class="col-md-6">

            <div class="form_field_container" id="search_area">
              <select class="form-control medium_field manage_search" id="search_field" name="search_field">
                <option value="Repository">Repository</option>
                <option value="City">City</option>
                <option value="State">State</option>
              </select>
              <input type="text" class="form-control manage_search medium_field" id="search_term"  name="search_term">
              <button type="submit" class="btn btn-primary manage_search" id="search"><span class="fa fa-search" aria-hidden="true"></span> Search</button>
            </div>

          </div>

          <div class="col-md-6">
          </div>

        </div>
      </form>

    <div class="row justify-content-center grid-buffer">

        <div class="table-responsive top-buffer">

            <table class="table table-striped">

                <tr class="table_header">
                    <th class="string_sortable">Repository</th>
                    <th>URL</th>
                    <th class="string_sortable">City</th>
                    <th class="string_sortable">State</th>
                </tr>

            {% for data in repositories %}
              <tr> 
                <td>{{ data.repository_name }}</td>
                <td><a href='{{ data.url }}'" target="_blank"> {{ data.url }}</a></td>
                <td>{{ data.st_city }}</td>
                <td>{{ data.state }}</td>
              </tr>
            {% endfor %}

          </table>
                  
        {% comment %} {% else %}
          
          <p>As a NAFAN Admin will have access to thousands of repositories, a pick list or grid is infeasible.  Instead,
             an autocomplete mechansim will provide faster access to the desired repository.  This assumes an admin has
             no reason to browse repositories, but is looking for a specific one.  Start entering the name of the repository
             in the input box below.  As you type, a list of matching repositories will display in a selection list 
             attached to the input box.  When you see the one desired, select the name and its information  will appear.
          </p>

          <p>The repository names are going to have to be unique.  For example, I have seen things like Johnson County Historical
             Society across multiple states.  These names would have to be expanded to Johnson County Missouri Historical Society.
          </p>

          <input type="text" id="tags">

        {% endif %} {% endcomment %}

        </div>

</div>

<script>

  $(document).ready(function() {
      NAFAN = {};

      $.ajax({
          url: '/ajax/get_organization_search/',
          data: { },
          dataType: 'json',
          success: function (data) {
            $('#search_field').val(data.SearchField);
            $('#search_term').val(data.SearchTerm);
          }
        });

  });

  $.curCSS = function(element, prop, val) {
    return $(element).css(prop, val);
  };

  function getCellValue(row, index) {

    return $(row).children('td').eq(index).text()

  }

  $('.string_sortable').click(function () {

      var table = $(this).parents('table').eq(0)

      var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))

      NAFAN.asc = !NAFAN.asc

      if (!NAFAN.asc) {

          rows = rows.reverse()

      }

      for (var i = 0; i < rows.length; i++) {

          table.append(rows[i])

      }

  })

  function comparer(index) {

      return function (a, b) {

          var valA = getCellValue(a, index), valB = getCellValue(b, index)

          return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.localeCompare(valB)

      }
  }

  </script>