<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    {% block title %}<title>NAFAN - The National Finding Aid Network</title>{% endblock %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">

    <!-- Add additional CSS in static file -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'site.css' %}"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js">  </script>    
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">  </script> 
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>    
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"rel="stylesheet" type="text/css" />  

</head>

<body>

<div class="container_fluid">

    <div class="row top-buffer">

        <div class="col-sm-2">
            {% if user_type == "contributor_admin" %}
            <a href="/Admin/contributor_admin">Admin</a>
            {% else %}
            <a href="/Admin/nafan_admin">Admin</a>
            {% endif %}
        </div>

        <div class="col-sm-8">
            <h2 class="page-header text-center"> Repositories </h2>
        </div>

        <div class="col-sm-2">
            <button class="btn btn-md btn-primary float-right" type="button" onclick="location.href='/logout'">Logout</button>
        </div>
      
    </div>

      <form method="get">
      {% csrf_token %}

        <div class="row grid-buffer">

          <div class="col-md-6">

            <div class="form_field_container" id="search_area">
              <select class="form-control medium_field manage_search" id="search_field" name="search_field">
                <option value="repository_name">Repository</option>
                <option value="state">State</option>
              </select>
              <input type="text" class="form-control manage_search medium_field" id="search_term"  name="search_term">
              <button type="submit" class="btn btn-primary manage_search" id="search"><span class="fa fa-search" aria-hidden="true"></span> Search</button>
            </div>

          </div>

          <div class="col-md-6">

            <div class="form_field_container float-lg-right" id="new_button_area">
              <div class="button_container">
                <button type="button" class="btn btn-primary manage_search" id="new" onclick="location.href='/Repositories/create_repository'"><span class="fal icon_spacer"></span> New Repository</button>
              </div>
            </div>

          </div>

        </div>
      </form>

    <div class="row justify-content-center grid-buffer">

        <div class="table-responsive top-buffer">

            <table class="table table-striped">

                <tr>
                    <th>Repository</th>
                    <th>State</th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>

            {% for data in repositories %}
              <tr> 
                <td>{{ data.repository_name }}</td>
                <td>{{ data.state }}</td>
                <td><a href='/Repositories/update_repository/{{ data.pk }}'"> Edit</a></td>
                <td><a href='/Repositories/delete_repository/{{ data.pk }}'"> Delete</a></td>
                <td><a href='/FindingAids/finding_aids/{{ data.pk }}'"> Finding Aids</a></td>
              </tr>
            {% endfor %}

          </table>
                  
        {% comment %} {% else %}
          
          <p>As a NAFAN Admin will have access to thousands of repositories, a pick list or grid is infeasible.  Instead,
             an autocomplete mechansim will provide faster access to the desired repository.  This assumes an admin has
             no reason to browse repositories, but is looking for a specific one.  Start entering the name of the repository
             in the input box below.  As you type, a list of matching repositories will display in a selection list 
             attached to the input box.  When you see the one desired, select the name and its information  will appear.
          </p>

          <p>The repository names are going to have to be unique.  For example, I have seen things like Johnson County Historical
             Society across multiple states.  These names would have to be expanded to Johnson County Missouri Historical Society.
          </p>

          <input type="text" id="tags">

        {% endif %} {% endcomment %}

        </div>

</div>

<script>

  $(document).ready(function() {
      NAFAN = {};
  });

  $.curCSS = function(element, prop, val) {
    return $(element).css(prop, val);
  };

  $(function() {
    NAFAN.availableTags = [
      {% for repository in repositories %}
        "{{ repository.repository_name }}",
      {% endfor %}
    ];

    $("#tags").autocomplete({
      source: NAFAN.availableTags,

      select: function (event, ui) {

        $.ajax({
          url: '/smith/get_repository/',
          data: {'name' : ui.item.label},
          dataType: 'json',
          success: function (data) {
            // Really hating the way Django is returning objects
            location.href = "/Repositories/update_repository/" + data.id;
          }
        });


      }
    })
  });

  </script>